{% extends 'base.html' %}

{% block title %}Category Detail - AI Taskboard{% endblock %}

{% block extra_css %}
<style>
    /* Custom CSS for drag and drop */
    .kanban-lane {
        min-height: 400px;
    }
    .task-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .task-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .task-card.dragging {
        opacity: 0.5;
        transform: rotate(3deg);
    }
    .lane-placeholder {
        border: 2px dashed #ccc;
        border-radius: 0.5rem;
        background-color: #f8fafc;
        min-height: 100px;
        margin-bottom: 1rem;
    }
    
    /* Mobile swipe tabs */
    @media (max-width: 768px) {
        .mobile-tab-content {
            display: none;
        }
        .mobile-tab-content.active {
            display: block;
        }
        .kanban-lane {
            min-height: auto;
            margin-bottom: 1rem;
        }
        .kanban-container {
            flex-direction: column;
        }
    }
    
    /* Priority indicators */
    .priority-high {
        border-left: 4px solid #ef4444;
    }
    .priority-medium {
        border-left: 4px solid #f59e0b;
    }
    .priority-low {
        border-left: 4px solid #10b981;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div class="flex items-center space-x-4">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Website Redesign</h1>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                Project: Marketing
            </span>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">
                <span class="w-2 h-2 mr-1 rounded-full bg-purple-500"></span>
                Design
            </span>
        </div>
        <div class="mt-2 sm:mt-0">
            <span class="text-sm text-gray-500 dark:text-gray-400">12 tasks</span>
        </div>
    </div>
</div>

<!-- Tabs -->
<div class="border-b border-gray-200 dark:border-gray-700 mb-6">
    <nav class="-mb-px flex space-x-8" id="desktop-tabs">
        <button class="tab-button border-b-2 border-blue-500 text-blue-600 dark:text-blue-400 whitespace-nowrap py-4 px-1 text-sm font-medium" data-tab="tasks">
            Tasks
        </button>
        <button class="tab-button border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 whitespace-nowrap py-4 px-1 text-sm font-medium" data-tab="info">
            Info
        </button>
    </nav>
    
    <!-- Mobile tabs -->
    <div class="sm:hidden flex overflow-x-auto py-2" id="mobile-tabs">
        <button class="mobile-tab-button flex-shrink-0 px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 border-b-2 border-blue-500" data-tab="tasks">
            Tasks
        </button>
        <button class="mobile-tab-button flex-shrink-0 px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 border-b-2 border-transparent" data-tab="info">
            Info
        </button>
    </div>
</div>

<!-- Tab Content -->
<div id="tasks-content" class="mobile-tab-content active">
    <!-- Kanban Board -->
    <div class="kanban-container grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- To Do Column -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">To Do</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400">4 tasks</span>
            </div>
            <div class="kanban-lane space-y-3" data-lane="todo">
                <!-- Task Card 1 -->
                <div class="task-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-move border-l-4 border-gray-400" draggable="true">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Design homepage layout</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Create wireframes and mockups for the new homepage design</p>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200">
                                    Medium
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Due: Dec 15</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 ml-3">
                            <img class="h-6 w-6 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Task Card 2 -->
                <div class="task-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-move border-l-4 border-red-400" draggable="true">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Create brand guidelines</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Develop comprehensive brand style guide and design system</p>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">
                                    High
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Due: Dec 10</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 ml-3">
                            <img class="h-6 w-6 rounded-full" src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Add Task Button -->
                <button class="w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Add Task
                </button>
            </div>
        </div>
        
        <!-- In Progress Column -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">In Progress</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400">3 tasks</span>
            </div>
            <div class="kanban-lane space-y-3" data-lane="progress">
                <!-- Task Card 3 -->
                <div class="task-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-move border-l-4 border-blue-400" draggable="true">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Design logo variations</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Create multiple logo options for client review</p>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                    In Progress
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Due: Dec 20</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 ml-3">
                            <img class="h-6 w-6 rounded-full" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Add Task Button -->
                <button class="w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Add Task
                </button>
            </div>
        </div>
        
        <!-- Done Column -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Done</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400">5 tasks</span>
            </div>
            <div class="kanban-lane space-y-3" data-lane="done">
                <!-- Task Card 4 -->
                <div class="task-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-move border-l-4 border-green-400" draggable="true">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Research competitors</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Analyze competitor websites and design trends</p>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                    Completed
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Dec 5</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 ml-3">
                            <img class="h-6 w-6 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Add Task Button -->
                <button class="w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Add Task
                </button>
            </div>
        </div>
    </div>
    
    <!-- Placeholder elements for drag and drop -->
    <div class="lane-placeholder hidden" data-lane="todo"></div>
    <div class="lane-placeholder hidden" data-lane="progress"></div>
    <div class="lane-placeholder hidden" data-lane="done"></div>
</div>

<div id="info-content" class="mobile-tab-content">
    <!-- Category Information -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Category Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h4 class="font-medium text-gray-900 dark:text-white mb-2">Description</h4>
                <p class="text-gray-600 dark:text-gray-300">Design-related tasks for the website redesign project. This category includes UI/UX design, graphic design, and design system development.</p>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 dark:text-white mb-2">Statistics</h4>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-300">Total Tasks:</span>
                        <span class="font-medium text-gray-900 dark:text-white">12</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-300">Completed:</span>
                        <span class="font-medium text-green-600 dark:text-green-400">5</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-300">In Progress:</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400">3</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-300">To Do:</span>
                        <span class="font-medium text-gray-600 dark:text-gray-400">4</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const mobileTabButtons = document.querySelectorAll('.mobile-tab-button');
        const tabContents = document.querySelectorAll('.mobile-tab-content');
        
        function switchTab(tabName) {
            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active state from all buttons
            tabButtons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });
            
            mobileTabButtons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.add('active');
            
            // Update active button states
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                activeButton.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            }
        }
        
        // Add click event listeners
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });
        
        mobileTabButtons.forEach(button => {
            button.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });
        
        // Drag and drop functionality
        const cards = document.querySelectorAll('.task-card');
        const lanes = document.querySelectorAll('.kanban-lane');
        const placeholders = {};
        let draggedItem = null;
        
        // Create placeholders for each lane
        lanes.forEach(lane => {
            const laneId = lane.dataset.lane;
            const placeholder = document.createElement('div');
            placeholder.className = 'lane-placeholder';
            placeholder.dataset.lane = laneId;
            placeholders[laneId] = placeholder;
        });
        
        cards.forEach(card => {
            card.addEventListener('dragstart', function() {
                draggedItem = this;
                setTimeout(() => {
                    this.classList.add('dragging');
                }, 0);
            });
            
            card.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                Object.values(placeholders).forEach(placeholder => {
                    placeholder.classList.add('hidden');
                });
            });
        });
        
        Object.entries(lanes).forEach(([laneId, lane]) => {
            lane.addEventListener('dragover', function(e) {
                e.preventDefault();
                placeholders[laneId].classList.remove('hidden');
                const afterElement = getDragAfterElement(lane, e.clientY);
                if (afterElement) {
                    lane.insertBefore(placeholders[laneId], afterElement);
                } else {
                    lane.appendChild(placeholders[laneId]);
                }
            });
            
            lane.addEventListener('dragleave', function() {
                placeholders[laneId].classList.add('hidden');
            });
            
            lane.addEventListener('drop', function(e) {
                e.preventDefault();
                placeholders[laneId].classList.add('hidden');
                if (draggedItem) {
                    const afterElement = getDragAfterElement(lane, e.clientY);
                    if (afterElement) {
                        lane.insertBefore(draggedItem, afterElement);
                    } else {
                        lane.appendChild(draggedItem);
                    }
                    
                    // Update task count (simplified for demo)
                    const countElement = this.parentElement.querySelector('span:last-child');
                    const currentCount = parseInt(countElement.textContent.split(' ')[0]);
                    countElement.textContent = `${currentCount + 1} tasks`;
                    
                    // Update the lane the dragged item came from
                    const originalLane = draggedItem.parentElement.parentElement;
                    if (originalLane !== this.parentElement) {
                        const originalCountElement = originalLane.querySelector('span:last-child');
                        const originalCount = parseInt(originalCountElement.textContent.split(' ')[0]);
                        originalCountElement.textContent = `${originalCount - 1} tasks`;
                    }
                }
            });
        });
        
        function getDragAfterElement(lane, y) {
            const draggableElements = [...lane.querySelectorAll('.task-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Mobile swipe detection (simplified)
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.getElementById('tasks-content').addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        }, false);
        
        document.getElementById('tasks-content').addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, false);
        
        function handleSwipe() {
            if (touchEndX < touchStartX - 50) {
                // Swipe left - switch to Info tab
                document.querySelector('.mobile-tab-button[data-tab="info"]').click();
            }
            
            if (touchEndX > touchStartX + 50) {
                // Swipe right - switch to Tasks tab
                document.querySelector('.mobile-tab-button[data-tab="tasks"]').click();
            }
        }
    });
</script>
{% endblock %}