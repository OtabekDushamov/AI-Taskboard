{% extends 'base.html' %}

{% block title %}Categories Manager - AI Taskboard{% endblock %}

{% block extra_css %}
<style>
    .fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in {
        animation: slideIn 0.3s ease-in-out;
    }
    
    @keyframes slideIn {
        from { opacity: 0; transform: translateX(10px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    .checkbox-container {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
    }
    
    .checkbox-container input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .slider {
        background-color: #0ea5e9;
    }
    
    input:checked + .slider:before {
        transform: translateX(20px);
    }
    
    .dark input:checked + .slider {
        background-color: #0284c7;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Categories Manager</h1>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Organize your tasks with custom categories and labels</p>
    </div>
    <div class="mt-4 sm:mt-0">
        <button onclick="openCategoryModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            <i class="fas fa-plus mr-2"></i>New Category
        </button>
    </div>
</div>

<!-- Filters and Search -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label for="search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search</label>
            <input type="text" id="search" placeholder="Search categories..." class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100">
        </div>
        <div>
            <label for="project-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Project</label>
            <select id="project-filter" class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100">
                <option value="">All Projects</option>
                <option value="1">Website Redesign</option>
                <option value="2">Mobile App</option>
                <option value="3">Marketing Campaign</option>
            </select>
        </div>
        <div>
            <label for="status-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
            <select id="status-filter" class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
        </div>
        <div class="flex items-end">
            <button onclick="applyFilters()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                Apply Filters
            </button>
        </div>
    </div>
</div>

<!-- Categories Grid -->
<div id="categories-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Category cards will be dynamically generated here -->
</div>

<!-- Create/Edit Category Modal -->
<div id="category-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3">
            <h3 id="modal-title" class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Category</h3>
            <form id="category-form" onsubmit="handleFormSubmit(event)">
                <input type="hidden" id="category-id">
                
                <div class="mb-4">
                    <label for="category-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category Name</label>
                    <input type="text" id="category-name" required class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100">
                </div>
                
                <div class="mb-4">
                    <label for="category-project" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Project</label>
                    <select id="category-project" required class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100">
                        <option value="1">Website Redesign</option>
                        <option value="2">Mobile App</option>
                        <option value="3">Marketing Campaign</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="category-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                    <textarea id="category-description" rows="3" class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm text-gray-900 dark:text-gray-100"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Color</label>
                    <div class="flex space-x-2">
                        <div class="color-option bg-red-500 w-8 h-8 rounded-full cursor-pointer ring-2 ring-offset-2 ring-primary-500" data-color="red"></div>
                        <div class="color-option bg-blue-500 w-8 h-8 rounded-full cursor-pointer" data-color="blue"></div>
                        <div class="color-option bg-green-500 w-8 h-8 rounded-full cursor-pointer" data-color="green"></div>
                        <div class="color-option bg-yellow-500 w-8 h-8 rounded-full cursor-pointer" data-color="yellow"></div>
                        <div class="color-option bg-purple-500 w-8 h-8 rounded-full cursor-pointer" data-color="purple"></div>
                        <div class="color-option bg-pink-500 w-8 h-8 rounded-full cursor-pointer" data-color="pink"></div>
                    </div>
                    <input type="hidden" id="category-color" value="blue">
                </div>
                
                <div class="mb-6">
                    <label class="checkbox-container">
                        <input type="checkbox" id="category-active" checked>
                        <span class="slider"></span>
                    </label>
                    <span class="ml-3 text-sm text-gray-700 dark:text-gray-300">Active</span>
                </div>
                
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-primary-600 hover:bg-primary-700 text-white py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                        Save
                    </button>
                    <button type="button" onclick="closeCategoryModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 dark:text-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900">
                <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-4">Delete Category</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Are you sure you want to delete this category? This action cannot be undone.</p>
            <div class="flex space-x-3 mt-6">
                <button onclick="deleteCategory()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                    Delete
                </button>
                <button onclick="closeDeleteModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 dark:text-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sample data - in a real app, this would come from the backend
    let categories = [
        {
            id: 1,
            name: 'Design',
            projectId: 1,
            project: 'Website Redesign',
            tasks: 12,
            active: true,
            color: 'blue',
            description: 'All design-related tasks including UI/UX, graphics, and layouts',
            createdAt: '2023-12-01'
        },
        {
            id: 2,
            name: 'Development',
            projectId: 1,
            project: 'Website Redesign',
            tasks: 8,
            active: true,
            color: 'green',
            description: 'Frontend and backend development tasks',
            createdAt: '2023-12-01'
        },
        {
            id: 3,
            name: 'Testing',
            projectId: 1,
            project: 'Website Redesign',
            tasks: 5,
            active: true,
            color: 'yellow',
            description: 'Quality assurance and testing tasks',
            createdAt: '2023-12-02'
        },
        {
            id: 4,
            name: 'Content',
            projectId: 1,
            project: 'Website Redesign',
            tasks: 3,
            active: false,
            color: 'purple',
            description: 'Content creation and copywriting tasks',
            createdAt: '2023-12-02'
        }
    ];
    
    let currentCategoryId = null;
    let isEditing = false;
    
    // DOM elements
    const categoryModal = document.getElementById('category-modal');
    const deleteModal = document.getElementById('delete-modal');
    const modalTitle = document.getElementById('modal-title');
    const categoryForm = document.getElementById('category-form');
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        renderCategories(categories);
        setupColorSelection();
    });
    
    // Render categories in the grid
    function renderCategories(categoriesToRender) {
        const grid = document.getElementById('categories-grid');
        grid.innerHTML = '';
        
        categoriesToRender.forEach(category => {
            const card = createCategoryCard(category);
            grid.appendChild(card);
        });
    }
    
    // Create a category card element
    function createCategoryCard(category) {
        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow duration-200 fade-in';
        
        const statusClass = category.active ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200';
        const statusText = category.active ? 'Active' : 'Inactive';
        
        card.innerHTML = `
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-4 h-4 rounded-full bg-${category.color}-500"></div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${category.name}</h3>
                </div>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
                    ${statusText}
                </span>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 mb-4">${category.description}</p>
            
            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4">
                <span><i class="fas fa-folder mr-1"></i>${category.project}</span>
                <span><i class="fas fa-tasks mr-1"></i>${category.tasks} tasks</span>
            </div>
            
            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4">
                <span>Created: ${formatDate(category.createdAt)}</span>
            </div>
            
            <div class="flex space-x-2">
                <button onclick="viewCategory(${category.id})" class="flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200">
                    <i class="fas fa-eye mr-1"></i>View
                </button>
                <button onclick="editCategory(${category.id})" class="flex-1 bg-primary-100 dark:bg-primary-900 hover:bg-primary-200 dark:hover:bg-primary-800 text-primary-700 dark:text-primary-300 py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200">
                    <i class="fas fa-edit mr-1"></i>Edit
                </button>
                <button onclick="confirmDelete(${category.id})" class="flex-1 bg-red-100 dark:bg-red-900 hover:bg-red-200 dark:hover:bg-red-800 text-red-700 dark:text-red-300 py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200">
                    <i class="fas fa-trash mr-1"></i>Delete
                </button>
            </div>
        `;
        
        return card;
    }
    
    // Setup color selection in the modal
    function setupColorSelection() {
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove ring from all options
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.classList.remove('ring-2', 'ring-offset-2', 'ring-primary-500');
                });
                
                // Add ring to selected option
                this.classList.add('ring-2', 'ring-offset-2', 'ring-primary-500');
                
                // Update hidden input
                document.getElementById('category-color').value = this.dataset.color;
            });
        });
    }
    
    // Format date for display
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString();
    }
    
    // Apply filters
    function applyFilters() {
        const searchTerm = document.getElementById('search').value.toLowerCase();
        const projectFilter = document.getElementById('project-filter').value;
        const statusFilter = document.getElementById('status-filter').value;
        
        let filteredCategories = categories.filter(category => {
            const matchesSearch = category.name.toLowerCase().includes(searchTerm) || 
                                category.description.toLowerCase().includes(searchTerm);
            const matchesProject = !projectFilter || category.projectId == projectFilter;
            const matchesStatus = !statusFilter || 
                                (statusFilter === 'active' && category.active) ||
                                (statusFilter === 'inactive' && !category.active);
            
            return matchesSearch && matchesProject && matchesStatus;
        });
        
        renderCategories(filteredCategories);
    }
    
    // Open category modal
    function openCategoryModal(category = null) {
        isEditing = category !== null;
        
        if (isEditing) {
            modalTitle.textContent = 'Edit Category';
            document.getElementById('category-id').value = category.id;
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-project').value = category.projectId;
            document.getElementById('category-description').value = category.description;
            document.getElementById('category-active').checked = category.active;
            
            // Set color
            document.getElementById('category-color').value = category.color;
            document.querySelector(`.color-option.bg-${category.color}-500`).classList.add('ring-2', 'ring-offset-2', 'ring-primary-500');
        } else {
            modalTitle.textContent = 'Create Category';
            categoryForm.reset();
            document.getElementById('category-active').checked = true;
            
            // Reset color selection
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('ring-2', 'ring-offset-2', 'ring-primary-500');
            });
            document.querySelector('.color-option.bg-blue-500').classList.add('ring-2', 'ring-offset-2', 'ring-primary-500');
            document.getElementById('category-color').value = 'blue';
        }
        
        categoryModal.classList.remove('hidden');
    }
    
    // Close category modal
    function closeCategoryModal() {
        categoryModal.classList.add('hidden');
    }
    
    // Open delete confirmation modal
    function confirmDelete(id) {
        currentCategoryId = id;
        deleteModal.classList.remove('hidden');
    }
    
    // Close delete confirmation modal
    function closeDeleteModal() {
        deleteModal.classList.add('hidden');
    }
    
    // View category
    function viewCategory(id) {
        const category = categories.find(cat => cat.id == id);
        alert(`Viewing category: ${category.name}\n\nProject: ${category.project}\nTasks: ${category.tasks}\nStatus: ${category.active ? 'Active' : 'Inactive'}\nCreated: ${formatDate(category.createdAt)}\n\nDescription: ${category.description}`);
    }
    
    // Edit category
    function editCategory(id) {
        const category = categories.find(cat => cat.id == id);
        openCategoryModal(category);
    }
    
    // Handle form submission
    function handleFormSubmit(e) {
        e.preventDefault();
        
        const formData = {
            id: isEditing ? parseInt(document.getElementById('category-id').value) : categories.length + 1,
            name: document.getElementById('category-name').value,
            projectId: parseInt(document.getElementById('category-project').value),
            project: document.getElementById('category-project').options[document.getElementById('category-project').selectedIndex].text,
            tasks: isEditing ? categories.find(cat => cat.id == currentCategoryId).tasks : 0,
            active: document.getElementById('category-active').checked,
            color: document.getElementById('category-color').value,
            description: document.getElementById('category-description').value,
            createdAt: isEditing ? categories.find(cat => cat.id == currentCategoryId).createdAt : new Date().toISOString().split('T')[0]
        };
        
        if (isEditing) {
            // Update existing category
            const index = categories.findIndex(cat => cat.id == currentCategoryId);
            categories[index] = formData;
        } else {
            // Add new category
            categories.push(formData);
        }
        
        renderCategories(categories);
        closeCategoryModal();
    }
    
    // Delete category
    function deleteCategory() {
        const index = categories.findIndex(cat => cat.id == currentCategoryId);
        if (index !== -1) {
            categories.splice(index, 1);
            renderCategories(categories);
        }
        closeDeleteModal();
    }
</script>
{% endblock %}