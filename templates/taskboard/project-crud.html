<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles for multi-select and dropzone */
        .multi-select-container {
            position: relative;
        }
        
        .multi-select-dropdown {
            display: none;
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .multi-select-dropdown.show {
            display: block;
        }
        
        .multi-select-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
        
        .multi-select-item:hover {
            background-color: #f8fafc;
        }
        
        .multi-select-item.selected {
            background-color: #eff6ff;
        }
        
        .multi-select-tag {
            display: inline-flex;
            align-items: center;
            background-color: #e0f2fe;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .multi-select-tag-remove {
            margin-left: 0.25rem;
            cursor: pointer;
        }
        
        .dropzone {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dropzone:hover {
            border-color: #94a3b8;
            background-color: #f8fafc;
        }
        
        .dropzone.active {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .file-preview {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background-color: #f1f5f9;
            border-radius: 0.375rem;
            margin-top: 0.5rem;
        }
        
        .file-preview-icon {
            margin-right: 0.5rem;
            color: #64748b;
        }
        
        .file-preview-name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-preview-remove {
            color: #ef4444;
            cursor: pointer;
        }
        
        .step-indicator {
            position: relative;
            flex: 1;
            text-align: center;
            padding-bottom: 1rem;
        }
        
        .step-indicator:not(:last-child):after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e2e8f0;
            z-index: 1;
        }
        
        .step-indicator.active:not(:last-child):after {
            background-color: #3b82f6;
        }
        
        .step-number {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            background-color: #e2e8f0;
            color: #64748b;
            z-index: 2;
        }
        
        .step-indicator.active .step-number {
            background-color: #3b82f6;
            color: white;
        }
        
        .step-indicator.completed .step-number {
            background-color: #10b981;
            color: white;
        }
        
        @media (max-width: 1023px) {
            .preview-column {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 class="text-xl font-semibold text-gray-900">Project Management</h1>
                <div class="flex items-center space-x-4">
                    <span id="autosave-indicator" class="text-sm text-gray-500 hidden">
                        <i class="fas fa-save mr-1"></i> Saving...
                    </span>
                    <span id="autosave-success" class="text-sm text-green-500 hidden">
                        <i class="fas fa-check-circle mr-1"></i> Saved
                    </span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <!-- Step Header -->
                <div class="mb-8">
                    <div class="flex justify-between mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">Create New Project</h2>
                        <div class="text-sm text-gray-500">
                            <span id="form-status">Draft</span>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="step-indicator active">
                            <div class="step-number">1</div>
                            <div class="text-sm font-medium text-gray-900 mt-1">Basic Info</div>
                        </div>
                        <div class="step-indicator">
                            <div class="step-number">2</div>
                            <div class="text-sm font-medium text-gray-500 mt-1">Details</div>
                        </div>
                        <div class="step-indicator">
                            <div class="step-number">3</div>
                            <div class="text-sm font-medium text-gray-500 mt-1">Team</div>
                        </div>
                        <div class="step-indicator">
                            <div class="step-number">4</div>
                            <div class="text-sm font-medium text-gray-500 mt-1">Review</div>
                        </div>
                    </div>
                </div>

                <!-- Form Content -->
                <div class="flex flex-col lg:flex-row gap-6">
                    <!-- Form Column -->
                    <div class="w-full lg:w-2/3 bg-white rounded-lg shadow-sm p-6">
                        <form id="project-form">
                            <!-- Name Field -->
                            <div class="mb-6">
                                <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Project Name *</label>
                                <input type="text" id="name" name="name" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Enter project name">
                                <p class="mt-1 text-sm text-gray-500">Give your project a clear, descriptive name</p>
                                <div id="name-error" class="mt-1 text-sm text-red-600 hidden">Project name is required</div>
                            </div>

                            <!-- Description Field -->
                            <div class="mb-6">
                                <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea id="description" name="description" rows="3" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Describe the project goals and scope"></textarea>
                                <p class="mt-1 text-sm text-gray-500">Briefly describe what this project is about</p>
                            </div>

                            <!-- Status and Priority Fields -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Status Field -->
                                <div>
                                    <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                                    <select id="status" name="status" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select status</option>
                                        <option value="not_started">Not Started</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="on_hold">On Hold</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                    <div id="status-error" class="mt-1 text-sm text-red-600 hidden">Status is required</div>
                                </div>

                                <!-- Priority Field -->
                                <div>
                                    <label for="priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                    <div class="flex space-x-2">
                                        <button type="button" class="priority-btn px-3 py-1 rounded-full text-sm" data-value="low">Low</button>
                                        <button type="button" class="priority-btn px-3 py-1 rounded-full text-sm" data-value="medium">Medium</button>
                                        <button type="button" class="priority-btn px-3 py-1 rounded-full text-sm" data-value="high">High</button>
                                        <button type="button" class="priority-btn px-3 py-1 rounded-full text-sm" data-value="critical">Critical</button>
                                    </div>
                                    <input type="hidden" id="priority" name="priority" value="medium">
                                </div>
                            </div>

                            <!-- Dates Fields -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Start Date Field -->
                                <div>
                                    <label for="start_date" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                    <input type="date" id="start_date" name="start_date"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <!-- Due Date Field -->
                                <div>
                                    <label for="due_date" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                                    <input type="date" id="due_date" name="due_date"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>

                            <!-- Owner Field -->
                            <div class="mb-6">
                                <label for="owner" class="block text-sm font-medium text-gray-700 mb-1">Project Owner *</label>
                                <select id="owner" name="owner" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select owner</option>
                                    <option value="1">John Doe</option>
                                    <option value="2">Jane Smith</option>
                                    <option value="3">Robert Johnson</option>
                                    <option value="4">Emily Davis</option>
                                </select>
                                <div id="owner-error" class="mt-1 text-sm text-red-600 hidden">Project owner is required</div>
                            </div>

                            <!-- Team Field (Multi-select) -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Team Members</label>
                                <div class="multi-select-container">
                                    <div class="flex items-center border border-gray-300 rounded-md shadow-sm px-3 py-2 cursor-pointer" id="team-select-trigger">
                                        <span class="text-gray-500 mr-2">Select team members</span>
                                        <i class="fas fa-chevron-down ml-auto text-gray-400"></i>
                                    </div>
                                    <div class="multi-select-dropdown" id="team-dropdown">
                                        <div class="multi-select-item" data-value="1">John Doe (Developer)</div>
                                        <div class="multi-select-item" data-value="2">Jane Smith (Designer)</div>
                                        <div class="multi-select-item" data-value="3">Robert Johnson (QA)</div>
                                        <div class="multi-select-item" data-value="4">Emily Davis (PM)</div>
                                        <div class="multi-select-item" data-value="5">Michael Brown (DevOps)</div>
                                        <div class="multi-select-item" data-value="6">Sarah Wilson (UX)</div>
                                    </div>
                                    <div class="multi-select-tags mt-2" id="team-tags"></div>
                                    <input type="hidden" id="team" name="team">
                                </div>
                            </div>

                            <!-- Labels Field (Tags) -->
                            <div class="mb-6">
                                <label for="labels" class="block text-sm font-medium text-gray-700 mb-1">Labels</label>
                                <div class="flex items-center border border-gray-300 rounded-md shadow-sm px-3 py-2">
                                    <input type="text" id="labels-input" class="flex-grow outline-none" placeholder="Add labels (press enter to add)">
                                    <span class="text-gray-500 text-sm">Press Enter to add</span>
                                </div>
                                <div class="flex flex-wrap mt-2" id="labels-container"></div>
                                <input type="hidden" id="labels" name="labels">
                            </div>

                            <!-- Attachments Field (Dropzone) -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Attachments</label>
                                <div class="dropzone" id="dropzone">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-600">Drag & drop files here or click to browse</p>
                                        <p class="text-sm text-gray-500 mt-1">Max file size: 10MB</p>
                                    </div>
                                </div>
                                <div class="mt-2" id="file-previews"></div>
                                <input type="file" id="file-input" class="hidden" multiple>
                            </div>
                        </form>
                    </div>

                    <!-- Preview Column (visible on lg screens) -->
                    <div class="preview-column w-full lg:w-1/3">
                        <div class="bg-white rounded-lg shadow-sm p-6 sticky top-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Project Preview</h3>
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 id="preview-name" class="text-lg font-semibold text-gray-800">Project Name</h4>
                                    <span id="preview-priority" class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Medium</span>
                                </div>
                                <p id="preview-description" class="text-sm text-gray-600 mb-4">Project description will appear here</p>
                                
                                <div class="flex items-center text-sm text-gray-500 mb-2">
                                    <i class="fas fa-calendar-alt mr-2"></i>
                                    <span id="preview-dates">No dates set</span>
                                </div>
                                
                                <div class="flex items-center text-sm text-gray-500 mb-2">
                                    <i class="fas fa-user mr-2"></i>
                                    <span id="preview-owner">No owner selected</span>
                                </div>
                                
                                <div class="flex items-center text-sm text-gray-500 mb-2">
                                    <i class="fas fa-tag mr-2"></i>
                                    <span id="preview-status">No status selected</span>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">Team Members</h5>
                                    <div id="preview-team" class="text-sm text-gray-600">No team members selected</div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">Labels</h5>
                                    <div id="preview-labels" class="flex flex-wrap gap-1">
                                        <span class="text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600">No labels</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">Attachments</h5>
                                    <div id="preview-attachments" class="text-sm text-gray-600">No files attached</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Sticky Footer -->
        <footer class="bg-white border-t border-gray-200 py-4 sticky bottom-0 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center">
                    <div>
                        <button type="button" id="cancel-btn" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Cancel
                        </button>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" id="delete-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 hidden">
                            Delete Project
                        </button>
                        <button type="button" id="save-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save Project
                        </button>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Form elements
            const form = document.getElementById('project-form');
            const nameInput = document.getElementById('name');
            const descriptionInput = document.getElementById('description');
            const statusSelect = document.getElementById('status');
            const priorityInput = document.getElementById('priority');
            const startDateInput = document.getElementById('start_date');
            const dueDateInput = document.getElementById('due_date');
            const ownerSelect = document.getElementById('owner');
            
            // Multi-select elements
            const teamSelectTrigger = document.getElementById('team-select-trigger');
            const teamDropdown = document.getElementById('team-dropdown');
            const teamTagsContainer = document.getElementById('team-tags');
            const teamHiddenInput = document.getElementById('team');
            
            // Tags elements
            const labelsInput = document.getElementById('labels-input');
            const labelsContainer = document.getElementById('labels-container');
            const labelsHiddenInput = document.getElementById('labels');
            
            // Dropzone elements
            const dropzone = document.getElementById('dropzone');
            const fileInput = document.getElementById('file-input');
            const filePreviews = document.getElementById('file-previews');
            
            // Buttons
            const priorityButtons = document.querySelectorAll('.priority-btn');
            const saveBtn = document.getElementById('save-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteBtn = document.getElementById('delete-btn');
            
            // Preview elements
            const previewName = document.getElementById('preview-name');
            const previewDescription = document.getElementById('preview-description');
            const previewPriority = document.getElementById('preview-priority');
            const previewDates = document.getElementById('preview-dates');
            const previewOwner = document.getElementById('preview-owner');
            const previewStatus = document.getElementById('preview-status');
            const previewTeam = document.getElementById('preview-team');
            const previewLabels = document.getElementById('preview-labels');
            const previewAttachments = document.getElementById('preview-attachments');
            
            // Autosave elements
            const autosaveIndicator = document.getElementById('autosave-indicator');
            const autosaveSuccess = document.getElementById('autosave-success');
            
            // Selected team members and files
            let selectedTeamMembers = [];
            let selectedLabels = [];
            let selectedFiles = [];
            
            // Initialize priority buttons
            function initPriorityButtons() {
                priorityButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        // Remove active class from all buttons
                        priorityButtons.forEach(btn => {
                            btn.classList.remove('bg-blue-100', 'text-blue-800', 'font-medium');
                            btn.classList.add('bg-gray-100', 'text-gray-700');
                        });
                        
                        // Add active class to clicked button
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-blue-100', 'text-blue-800', 'font-medium');
                        
                        // Update hidden input
                        const priority = this.getAttribute('data-value');
                        priorityInput.value = priority;
                        
                        // Update preview
                        updatePriorityPreview(priority);
                    });
                });
                
                // Set default priority
                const defaultPriority = priorityInput.value;
                document.querySelector(`.priority-btn[data-value="${defaultPriority}"]`).classList.remove('bg-gray-100', 'text-gray-700');
                document.querySelector(`.priority-btn[data-value="${defaultPriority}"]`).classList.add('bg-blue-100', 'text-blue-800', 'font-medium');
            }
            
            // Initialize team multi-select
            function initTeamMultiSelect() {
                // Toggle dropdown
                teamSelectTrigger.addEventListener('click', function() {
                    teamDropdown.classList.toggle('show');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    if (!teamSelectTrigger.contains(event.target) && !teamDropdown.contains(event.target)) {
                        teamDropdown.classList.remove('show');
                    }
                });
                
                // Handle item selection
                const teamItems = teamDropdown.querySelectorAll('.multi-select-item');
                teamItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        const text = this.textContent;
                        
                        // Toggle selection
                        this.classList.toggle('selected');
                        
                        // Update selected team members
                        if (this.classList.contains('selected')) {
                            selectedTeamMembers.push({ value, text });
                        } else {
                            selectedTeamMembers = selectedTeamMembers.filter(member => member.value !== value);
                        }
                        
                        // Update tags display
                        updateTeamTags();
                        
                        // Update preview
                        updateTeamPreview();
                    });
                });
            }
            
            // Update team tags display
            function updateTeamTags() {
                teamTagsContainer.innerHTML = '';
                
                if (selectedTeamMembers.length === 0) {
                    const emptyTag = document.createElement('span');
                    emptyTag.className = 'text-sm text-gray-500';
                    emptyTag.textContent = 'No team members selected';
                    teamTagsContainer.appendChild(emptyTag);
                    teamHiddenInput.value = '';
                    return;
                }
                
                selectedTeamMembers.forEach(member => {
                    const tag = document.createElement('div');
                    tag.className = 'multi-select-tag';
                    
                    const tagText = document.createElement('span');
                    tagText.className = 'text-sm';
                    tagText.textContent = member.text.split(' (')[0]; // Show only name
                    
                    const removeBtn = document.createElement('span');
                    removeBtn.className = 'multi-select-tag-remove text-xs';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        // Remove from selected
                        selectedTeamMembers = selectedTeamMembers.filter(m => m.value !== member.value);
                        
                        // Update UI
                        updateTeamTags();
                        
                        // Update dropdown item
                        const dropdownItem = teamDropdown.querySelector(`.multi-select-item[data-value="${member.value}"]`);
                        if (dropdownItem) {
                            dropdownItem.classList.remove('selected');
                        }
                        
                        // Update preview
                        updateTeamPreview();
                    });
                    
                    tag.appendChild(tagText);
                    tag.appendChild(removeBtn);
                    teamTagsContainer.appendChild(tag);
                });
                
                // Update hidden input
                teamHiddenInput.value = selectedTeamMembers.map(member => member.value).join(',');
            }
            
            // Initialize labels/tags
            function initLabels() {
                labelsInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && this.value.trim() !== '') {
                        e.preventDefault();
                        
                        const labelText = this.value.trim();
                        
                        // Add to selected labels if not already present
                        if (!selectedLabels.includes(labelText)) {
                            selectedLabels.push(labelText);
                            updateLabelsDisplay();
                        }
                        
                        // Clear input
                        this.value = '';
                    }
                });
            }
            
            // Update labels display
            function updateLabelsDisplay() {
                labelsContainer.innerHTML = '';
                
                if (selectedLabels.length === 0) {
                    labelsHiddenInput.value = '';
                    return;
                }
                
                selectedLabels.forEach((label, index) => {
                    const tag = document.createElement('div');
                    tag.className = 'flex items-center bg-gray-100 rounded-full px-3 py-1 text-sm text-gray-700 mr-2 mb-2';
                    
                    const tagText = document.createElement('span');
                    tagText.textContent = label;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'ml-1 text-gray-500 hover:text-gray-700';
                    removeBtn.innerHTML = '<i class="fas fa-times text-xs"></i>';
                    removeBtn.addEventListener('click', function() {
                        selectedLabels.splice(index, 1);
                        updateLabelsDisplay();
                        updateLabelsPreview();
                    });
                    
                    tag.appendChild(tagText);
                    tag.appendChild(removeBtn);
                    labelsContainer.appendChild(tag);
                });
                
                // Update hidden input
                labelsHiddenInput.value = selectedLabels.join(',');
                
                // Update preview
                updateLabelsPreview();
            }
            
            // Initialize dropzone
            function initDropzone() {
                // Handle click on dropzone
                dropzone.addEventListener('click', function() {
                    fileInput.click();
                });
                
                // Handle file input change
                fileInput.addEventListener('change', function() {
                    handleFiles(this.files);
                });
                
                // Handle drag over
                dropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('active');
                });
                
                // Handle drag leave
                dropzone.addEventListener('dragleave', function() {
                    this.classList.remove('active');
                });
                
                // Handle drop
                dropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('active');
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleFiles(e.dataTransfer.files);
                    }
                });
            }
            
            // Handle selected files
            function handleFiles(files) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // Check file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('File size exceeds 10MB limit: ' + file.name);
                        continue;
                    }
                    
                    // Add to selected files if not already present
                    const existingFile = selectedFiles.find(f => f.name === file.name && f.size === file.size);
                    if (!existingFile) {
                        selectedFiles.push(file);
                    }
                }
                
                // Update file previews
                updateFilePreviews();
                
                // Update preview
                updateAttachmentsPreview();
            }
            
            // Update file previews
            function updateFilePreviews() {
                filePreviews.innerHTML = '';
                
                if (selectedFiles.length === 0) {
                    return;
                }
                
                selectedFiles.forEach((file, index) => {
                    const preview = document.createElement('div');
                    preview.className = 'file-preview';
                    
                    const icon = document.createElement('div');
                    icon.className = 'file-preview-icon';
                    
                    // Set icon based on file type
                    if (file.type.startsWith('image/')) {
                        icon.innerHTML = '<i class="fas fa-image"></i>';
                    } else if (file.type.startsWith('video/')) {
                        icon.innerHTML = '<i class="fas fa-video"></i>';
                    } else if (file.type.startsWith('audio/')) {
                        icon.innerHTML = '<i class="fas fa-music"></i>';
                    } else if (file.type === 'application/pdf') {
                        icon.innerHTML = '<i class="fas fa-file-pdf"></i>';
                    } else if (file.type.includes('word') || file.type.includes('document')) {
                        icon.innerHTML = '<i class="fas fa-file-word"></i>';
                    } else if (file.type.includes('excel') || file.type.includes('spreadsheet')) {
                        icon.innerHTML = '<i class="fas fa-file-excel"></i>';
                    } else if (file.type.includes('powerpoint') || file.type.includes('presentation')) {
                        icon.innerHTML = '<i class="fas fa-file-powerpoint"></i>';
                    } else if (file.type.includes('zip') || file.type.includes('compressed')) {
                        icon.innerHTML = '<i class="fas fa-file-archive"></i>';
                    } else {
                        icon.innerHTML = '<i class="fas fa-file"></i>';
                    }
                    
                    const name = document.createElement('div');
                    name.className = 'file-preview-name';
                    name.textContent = file.name;
                    
                    const remove = document.createElement('div');
                    remove.className = 'file-preview-remove';
                    remove.innerHTML = '<i class="fas fa-times"></i>';
                    remove.addEventListener('click', function() {
                        selectedFiles.splice(index, 1);
                        updateFilePreviews();
                        updateAttachmentsPreview();
                    });
                    
                    preview.appendChild(icon);
                    preview.appendChild(name);
                    preview.appendChild(remove);
                    filePreviews.appendChild(preview);
                });
            }
            
            // Initialize form validation
            function initFormValidation() {
                // Validate on blur
                nameInput.addEventListener('blur', validateName);
                statusSelect.addEventListener('change', validateStatus);
                ownerSelect.addEventListener('change', validateOwner);
                
                // Validate on form submit
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const isNameValid = validateName();
                    const isStatusValid = validateStatus();
                    const isOwnerValid = validateOwner();
                    
                    if (isNameValid && isStatusValid && isOwnerValid) {
                        // Form is valid, proceed with submission
                        saveProject();
                    }
                });
            }
            
            // Validate name field
            function validateName() {
                const nameError = document.getElementById('name-error');
                
                if (nameInput.value.trim() === '') {
                    nameError.classList.remove('hidden');
                    nameInput.classList.add('border-red-500');
                    nameInput.classList.remove('border-gray-300');
                    return false;
                } else {
                    nameError.classList.add('hidden');
                    nameInput.classList.remove('border-red-500');
                    nameInput.classList.add('border-gray-300');
                    return true;
                }
            }
            
            // Validate status field
            function validateStatus() {
                const statusError = document.getElementById('status-error');
                
                if (statusSelect.value === '') {
                    statusError.classList.remove('hidden');
                    statusSelect.classList.add('border-red-500');
                    statusSelect.classList.remove('border-gray-300');
                    return false;
                } else {
                    statusError.classList.add('hidden');
                    statusSelect.classList.remove('border-red-500');
                    statusSelect.classList.add('border-gray-300');
                    return true;
                }
            }
            
            // Validate owner field
            function validateOwner() {
                const ownerError = document.getElementById('owner-error');
                
                if (ownerSelect.value === '') {
                    ownerError.classList.remove('hidden');
                    ownerSelect.classList.add('border-red-500');
                    ownerSelect.classList.remove('border-gray-300');
                    return false;
                } else {
                    ownerError.classList.add('hidden');
                    ownerSelect.classList.remove('border-red-500');
                    ownerSelect.classList.add('border-gray-300');
                    return true;
                }
            }
            
            // Initialize autosave
            function initAutosave() {
                // Debounce function to limit how often we save
                function debounce(func, wait) {
                    let timeout;
                    return function() {
                        const context = this, args = arguments;
                        clearTimeout(timeout);
                        timeout = setTimeout(function() {
                            func.apply(context, args);
                        }, wait);
                    };
                }
                
                // Save function
                const saveProject = debounce(function() {
                    // Show saving indicator
                    autosaveIndicator.classList.remove('hidden');
                    autosaveSuccess.classList.add('hidden');
                    
                    // Simulate API call
                    setTimeout(function() {
                        // Hide saving indicator and show success
                        autosaveIndicator.classList.add('hidden');
                        autosaveSuccess.classList.remove('hidden');
                        
                        // Hide success after 3 seconds
                        setTimeout(function() {
                            autosaveSuccess.classList.add('hidden');
                        }, 3000);
                    }, 1000);
                }, 1000);
                
                // Set up event listeners for autosave
                form.addEventListener('input', saveProject);
                form.addEventListener('change', saveProject);
            }
            
            // Initialize preview updates
            function initPreviewUpdates() {
                // Name
                nameInput.addEventListener('input', function() {
                    previewName.textContent = this.value || 'Project Name';
                });
                
                // Description
                descriptionInput.addEventListener('input', function() {
                    previewDescription.textContent = this.value || 'Project description will appear here';
                });
                
                // Status
                statusSelect.addEventListener('change', function() {
                    if (this.value) {
                        const statusText = this.options[this.selectedIndex].text;
                        previewStatus.textContent = statusText;
                    } else {
                        previewStatus.textContent = 'No status selected';
                    }
                });
                
                // Dates
                startDateInput.addEventListener('change', updateDatesPreview);
                dueDateInput.addEventListener('change', updateDatesPreview);
                
                // Owner
                ownerSelect.addEventListener('change', function() {
                    if (this.value) {
                        const ownerText = this.options[this.selectedIndex].text;
                        previewOwner.textContent = ownerText;
                    } else {
                        previewOwner.textContent = 'No owner selected';
                    }
                });
            }
            
            // Update priority preview
            function updatePriorityPreview(priority) {
                let priorityText = '';
                let priorityClass = '';
                
                switch (priority) {
                    case 'low':
                        priorityText = 'Low';
                        priorityClass = 'bg-green-100 text-green-800';
                        break;
                    case 'medium':
                        priorityText = 'Medium';
                        priorityClass = 'bg-blue-100 text-blue-800';
                        break;
                    case 'high':
                        priorityText = 'High';
                        priorityClass = 'bg-yellow-100 text-yellow-800';
                        break;
                    case 'critical':
                        priorityText = 'Critical';
                        priorityClass = 'bg-red-100 text-red-800';
                        break;
                }
                
                previewPriority.textContent = priorityText;
                previewPriority.className = `px-2 py-1 text-xs rounded-full ${priorityClass}`;
            }
            
            // Update dates preview
            function updateDatesPreview() {
                const startDate = startDateInput.value;
                const dueDate = dueDateInput.value;
                
                if (startDate && dueDate) {
                    const formattedStartDate = new Date(startDate).toLocaleDateString();
                    const formattedDueDate = new Date(dueDate).toLocaleDateString();
                    previewDates.textContent = `${formattedStartDate} - ${formattedDueDate}`;
                } else if (startDate) {
                    const formattedStartDate = new Date(startDate).toLocaleDateString();
                    previewDates.textContent = `Starts ${formattedStartDate}`;
                } else if (dueDate) {
                    const formattedDueDate = new Date(dueDate).toLocaleDateString();
                    previewDates.textContent = `Due ${formattedDueDate}`;
                } else {
                    previewDates.textContent = 'No dates set';
                }
            }
            
            // Update team preview
            function updateTeamPreview() {
                if (selectedTeamMembers.length === 0) {
                    previewTeam.textContent = 'No team members selected';
                    return;
                }
                
                // Show first 3 members and "+X more" if there are more
                const maxToShow = 3;
                const membersToShow = selectedTeamMembers.slice(0, maxToShow);
                const remainingCount = selectedTeamMembers.length - maxToShow;
                
                previewTeam.innerHTML = '';
                
                membersToShow.forEach(member => {
                    const memberElement = document.createElement('div');
                    memberElement.className = 'flex items-center mb-1';
                    
                    const avatar = document.createElement('div');
                    avatar.className = 'w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-xs mr-2';
                    avatar.textContent = member.text.charAt(0);
                    
                    const name = document.createElement('span');
                    name.textContent = member.text.split(' (')[0];
                    
                    memberElement.appendChild(avatar);
                    memberElement.appendChild(name);
                    previewTeam.appendChild(memberElement);
                });
                
                if (remainingCount > 0) {
                    const moreElement = document.createElement('div');
                    moreElement.className = 'text-sm text-gray-500';
                    moreElement.textContent = `+${remainingCount} more`;
                    previewTeam.appendChild(moreElement);
                }
            }
            
            // Update labels preview
            function updateLabelsPreview() {
                previewLabels.innerHTML = '';
                
                if (selectedLabels.length === 0) {
                    previewLabels.innerHTML = '<span class="text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600">No labels</span>';
                    return;
                }
                
                selectedLabels.forEach(label => {
                    const labelElement = document.createElement('span');
                    labelElement.className = 'text-xs px-2 py-1 bg-blue-100 rounded-full text-blue-800';
                    labelElement.textContent = label;
                    previewLabels.appendChild(labelElement);
                });
            }
            
            // Update attachments preview
            function updateAttachmentsPreview() {
                if (selectedFiles.length === 0) {
                    previewAttachments.textContent = 'No files attached';
                    return;
                }
                
                previewAttachments.innerHTML = '';
                
                const filesList = document.createElement('div');
                
                selectedFiles.slice(0, 3).forEach(file => {
                    const fileElement = document.createElement('div');
                    fileElement.className = 'flex items-center text-sm mb-1';
                    
                    const icon = document.createElement('i');
                    icon.className = 'fas fa-file text-gray-500 mr-2';
                    
                    const name = document.createElement('span');
                    name.className = 'truncate';
                    name.textContent = file.name;
                    
                    fileElement.appendChild(icon);
                    fileElement.appendChild(name);
                    filesList.appendChild(fileElement);
                });
                
                if (selectedFiles.length > 3) {
                    const moreElement = document.createElement('div');
                    moreElement.className = 'text-sm text-gray-500';
                    moreElement.textContent = `+${selectedFiles.length - 3} more files`;
                    filesList.appendChild(moreElement);
                }
                
                previewAttachments.appendChild(filesList);
            }
            
            // Save project
            function saveProject() {
                // Show saving indicator
                autosaveIndicator.classList.remove('hidden');
                autosaveSuccess.classList.add('hidden');
                
                // Simulate API call
                setTimeout(function() {
                    // Hide saving indicator and show success
                    autosaveIndicator.classList.add('hidden');
                    autosaveSuccess.classList.remove('hidden');
                    
                    // Update form status
                    document.getElementById('form-status').textContent = 'Saved';
                    
                    // Hide success after 3 seconds
                    setTimeout(function() {
                        autosaveSuccess.classList.add('hidden');
                    }, 3000);
                    
                    // Show delete button (edit mode)
                    deleteBtn.classList.remove('hidden');
                }, 1000);
            }
            
            // Initialize buttons
            function initButtons() {
                saveBtn.addEventListener('click', function() {
                    form.dispatchEvent(new Event('submit'));
                });
                
                cancelBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to cancel? All unsaved changes will be lost.')) {
                        // Reset form
                        form.reset();
                        selectedTeamMembers = [];
                        selectedLabels = [];
                        selectedFiles = [];
                        
                        // Update UI
                        updateTeamTags();
                        updateLabelsDisplay();
                        updateFilePreviews();
                        
                        // Reset preview
                        resetPreview();
                    }
                });
                
                deleteBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                        alert('Project deleted (simulated)');
                        // In a real app, would redirect to projects list
                    }
                });
            }
            
            // Reset preview
            function resetPreview() {
                previewName.textContent = 'Project Name';
                previewDescription.textContent = 'Project description will appear here';
                previewPriority.textContent = 'Medium';
                previewPriority.className = 'px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800';
                previewDates.textContent = 'No dates set';
                previewOwner.textContent = 'No owner selected';
                previewStatus.textContent = 'No status selected';
                previewTeam.textContent = 'No team members selected';
                previewLabels.innerHTML = '<span class="text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600">No labels</span>';
                previewAttachments.textContent = 'No files attached';
                
                // Reset form status
                document.getElementById('form-status').textContent = 'Draft';
                
                // Hide delete button
                deleteBtn.classList.add('hidden');
            }
            
            // Initialize everything
            function init() {
                initPriorityButtons();
                initTeamMultiSelect();
                initLabels();
                initDropzone();
                initFormValidation();
                initAutosave();
                initPreviewUpdates();
                initButtons();
            }
            
            init();
        });
    </script>
</body>
</html>