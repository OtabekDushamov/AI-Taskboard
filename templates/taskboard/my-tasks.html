<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tasks | Personal Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --todo-bg: #f0f9ff;
            --todo-border: #bae6fd;
            --progress-bg: #fff7ed;
            --progress-border: #fed7aa;
            --review-bg: #fef2f2;
            --review-border: #fecaca;
            --done-bg: #f0fdf4;
            --done-border: #bbf7d0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
        }

        .lane {
            min-width: 300px;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .lane-header {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-weight: 600;
        }

        .lane.todo .lane-header {
            background-color: var(--todo-bg);
            border-bottom: 2px solid var(--todo-border);
            color: #0369a1;
        }

        .lane.progress .lane-header {
            background-color: var(--progress-bg);
            border-bottom: 2px solid var(--progress-border);
            color: #9a3412;
        }

        .lane.review .lane-header {
            background-color: var(--review-bg);
            border-bottom: 2px solid var(--review-border);
            color: #b91c1c;
        }

        .lane.done .lane-header {
            background-color: var(--done-bg);
            border-bottom: 2px solid var(--done-border);
            color: #15803d;
        }

        .card {
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card.todo {
            background-color: white;
            border-left: 4px solid var(--todo-border);
        }

        .card.progress {
            background-color: white;
            border-left: 4px solid var(--progress-border);
        }

        .card.review {
            background-color: white;
            border-left: 4px solid var(--review-border);
        }

        .card.done {
            background-color: white;
            border-left: 4px solid var(--done-border);
        }

        .card-overdue {
            border-left: 4px solid #ef4444 !important;
        }

        .project-chip {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }

        .priority-high {
            color: #dc2626;
        }

        .priority-medium {
            color: #ea580c;
        }

        .priority-low {
            color: #65a30d;
        }

        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e2e8f0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-fill.todo {
            background-color: #38bdf8;
        }

        .progress-fill.progress {
            background-color: #fb923c;
        }

        .progress-fill.review {
            background-color: #f87171;
        }

        .progress-fill.done {
            background-color: #4ade80;
        }

        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
        }

        .mobile-lane-toggle {
            display: none;
        }

        @media (max-width: 768px) {
            .board-container {
                flex-direction: column;
                overflow-x: hidden;
            }

            .lane {
                width: 100%;
                margin-bottom: 1rem;
            }

            .lane.collapsed {
                height: 48px;
                overflow: hidden;
            }

            .mobile-lane-toggle {
                display: block;
            }

            .desktop-lane-toggle {
                display: none;
            }
        }

        .drag-over {
            background-color: #e2e8f0;
            border: 2px dashed #94a3b8;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">My Tasks</h1>
                <p class="text-gray-600">Personal task management board</p>
            </div>
            <div class="flex items-center gap-2">
                <button id="add-task-btn" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                    <i class="fas fa-plus"></i>
                    <span>Add Task</span>
                </button>
            </div>
        </div>

        <!-- Filters and Search -->
        <div class="bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex flex-col md:flex-row justify-between gap-4">
                <div class="flex flex-wrap gap-2">
                    <button class="filter-btn active px-3 py-1 rounded-full border border-gray-300 text-sm" data-filter="all">
                        All Tasks
                    </button>
                    <button class="filter-btn px-3 py-1 rounded-full border border-gray-300 text-sm" data-filter="overdue">
                        Only Overdue
                    </button>
                    <button class="filter-btn px-3 py-1 rounded-full border border-gray-300 text-sm" data-filter="week">
                        Next 7 Days
                    </button>
                    <button class="filter-btn px-3 py-1 rounded-full border border-gray-300 text-sm" data-filter="high">
                        High Priority
                    </button>
                </div>
                <div class="relative w-full md:w-auto">
                    <input type="text" placeholder="Search tasks..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>
        </div>

        <!-- Board -->
        <div class="board-container flex gap-4 overflow-x-auto pb-4">
            <!-- To Do Lane -->
            <div class="lane todo" data-status="todo">
                <div class="lane-header flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span>To Do</span>
                        <span class="wip-counter bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full">3</span>
                    </div>
                    <button class="lane-toggle mobile-lane-toggle text-gray-500">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="lane-content p-2">
                    <div class="card todo" draggable="true" data-id="1" data-due="2023-06-15" data-priority="high">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Design new dashboard layout</h3>
                                <span class="priority-high"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-blue-100 text-blue-800">Website Redesign</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 15</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (1/3)</span>
                                    <span>33%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill todo" style="width: 33%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card todo" draggable="true" data-id="2" data-due="2023-06-20" data-priority="medium">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Write blog post about productivity</h3>
                                <span class="priority-medium"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-purple-100 text-purple-800">Content Creation</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 20</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (0/2)</span>
                                    <span>0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill todo" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card todo card-overdue" draggable="true" data-id="3" data-due="2023-06-10" data-priority="low">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Update dependencies</h3>
                                <span class="priority-low"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-green-100 text-green-800">Maintenance</span>
                                <span class="text-xs text-red-500"><i class="far fa-calendar-alt mr-1"></i>Overdue</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (0/1)</span>
                                    <span>0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill todo" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2">
                    <button class="add-card-btn w-full py-2 text-sm text-gray-500 hover:text-gray-700 rounded hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-1"></i> Add task
                    </button>
                </div>
            </div>

            <!-- In Progress Lane -->
            <div class="lane progress" data-status="progress">
                <div class="lane-header flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span>In Progress</span>
                        <span class="wip-counter bg-orange-100 text-orange-800 text-xs font-medium px-2 py-0.5 rounded-full">2</span>
                    </div>
                    <button class="lane-toggle mobile-lane-toggle text-gray-500">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="lane-content p-2">
                    <div class="card progress" draggable="true" data-id="4" data-due="2023-06-18" data-priority="high">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Implement user authentication</h3>
                                <span class="priority-high"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-blue-100 text-blue-800">Website Redesign</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 18</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (2/4)</span>
                                    <span>50%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill progress" style="width: 50%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card progress" draggable="true" data-id="5" data-due="2023-06-25" data-priority="medium">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Create API documentation</h3>
                                <span class="priority-medium"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-purple-100 text-purple-800">Content Creation</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 25</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (1/3)</span>
                                    <span>33%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill progress" style="width: 33%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2">
                    <button class="add-card-btn w-full py-2 text-sm text-gray-500 hover:text-gray-700 rounded hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-1"></i> Add task
                    </button>
                </div>
            </div>

            <!-- Review Lane -->
            <div class="lane review" data-status="review">
                <div class="lane-header flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span>Review</span>
                        <span class="wip-counter bg-red-100 text-red-800 text-xs font-medium px-2 py-0.5 rounded-full">1</span>
                    </div>
                    <button class="lane-toggle mobile-lane-toggle text-gray-500">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="lane-content p-2">
                    <div class="card review" draggable="true" data-id="6" data-due="2023-06-22" data-priority="high">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">Code review for payment system</h3>
                                <span class="priority-high"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-blue-100 text-blue-800">Website Redesign</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 22</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (3/3)</span>
                                    <span>100%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill review" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2">
                    <button class="add-card-btn w-full py-2 text-sm text-gray-500 hover:text-gray-700 rounded hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-1"></i> Add task
                    </button>
                </div>
            </div>

            <!-- Completed Lane -->
            <div class="lane done" data-status="done">
                <div class="lane-header flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span>Completed</span>
                        <span class="wip-counter bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded-full">2</span>
                    </div>
                    <button class="lane-toggle mobile-lane-toggle text-gray-500">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="lane-content p-2">
                    <div class="card done" draggable="true" data-id="7" data-due="2023-06-12" data-priority="medium">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800 line-through">Setup development environment</h3>
                                <span class="priority-medium"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-green-100 text-green-800">Setup</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 12</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (2/2)</span>
                                    <span>100%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill done" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card done" draggable="true" data-id="8" data-due="2023-06-08" data-priority="low">
                        <div class="p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800 line-through">Research competitor analysis</h3>
                                <span class="priority-low"><i class="fas fa-exclamation-circle"></i></span>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="project-chip bg-purple-100 text-purple-800">Research</span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>Jun 8</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Subtasks (1/1)</span>
                                    <span>100%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill done" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2">
                    <button class="add-card-btn w-full py-2 text-sm text-gray-500 hover:text-gray-700 rounded hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-1"></i> Add task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Add New Task</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="add-task-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Task Title</label>
                    <input type="text" id="task-title" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project</label>
                    <select id="task-project" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="">Select Project</option>
                        <option value="Website Redesign">Website Redesign</option>
                        <option value="Content Creation">Content Creation</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Setup">Setup</option>
                        <option value="Research">Research</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                    <input type="date" id="task-due" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                    <select id="task-priority" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="">Select Priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Subtasks</label>
                    <div id="subtasks-container">
                        <div class="flex gap-2 mb-2">
                            <input type="text" class="subtask-input flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Subtask description">
                            <button type="button" class="remove-subtask px-3 py-2 text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" id="add-subtask" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-plus mr-1"></i> Add Subtask
                    </button>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
                        Add Task
                    </button>
                    <button type="button" id="cancel-add" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Task data structure
        let tasks = [
            { id: 1, title: "Design new dashboard layout", project: "Website Redesign", due: "2023-06-15", priority: "high", status: "todo", subtasks: [{ text: "Wireframe design", completed: true }, { text: "Color scheme", completed: false }, { text: "Typography", completed: false }] },
            { id: 2, title: "Write blog post about productivity", project: "Content Creation", due: "2023-06-20", priority: "medium", status: "todo", subtasks: [{ text: "Research", completed: false }, { text: "Outline", completed: false }] },
            { id: 3, title: "Update dependencies", project: "Maintenance", due: "2023-06-10", priority: "low", status: "todo", subtasks: [{ text: "Check for updates", completed: false }] },
            { id: 4, title: "Implement user authentication", project: "Website Redesign", due: "2023-06-18", priority: "high", status: "progress", subtasks: [{ text: "Login form", completed: true }, { text: "Registration", completed: true }, { text: "Password reset", completed: false }, { text: "Email verification", completed: false }] },
            { id: 5, title: "Create API documentation", project: "Content Creation", due: "2023-06-25", priority: "medium", status: "progress", subtasks: [{ text: "Endpoint list", completed: true }, { text: "Request examples", completed: false }, { text: "Response schemas", completed: false }] },
            { id: 6, title: "Code review for payment system", project: "Website Redesign", due: "2023-06-22", priority: "high", status: "review", subtasks: [{ text: "Security review", completed: true }, { text: "Performance review", completed: true }, { text: "Code quality", completed: true }] },
            { id: 7, title: "Setup development environment", project: "Setup", due: "2023-06-12", priority: "medium", status: "done", subtasks: [{ text: "Install tools", completed: true }, { text: "Configure settings", completed: true }] },
            { id: 8, title: "Research competitor analysis", project: "Research", due: "2023-06-08", priority: "low", status: "done", subtasks: [{ text: "Identify competitors", completed: true }] }
        ];

        let currentFilter = 'all';
        let searchQuery = '';

        // DOM elements
        const boardContainer = document.querySelector('.board-container');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const searchInput = document.querySelector('input[placeholder="Search tasks..."]');
        const addTaskBtn = document.getElementById('add-task-btn');
        const addTaskModal = document.getElementById('add-task-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelAddBtn = document.getElementById('cancel-add');
        const addTaskForm = document.getElementById('add-task-form');
        const addSubtaskBtn = document.getElementById('add-subtask');
        const subtasksContainer = document.getElementById('subtasks-container');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeFilters();
            initializeSearch();
            initializeModal();
            initializeMobileLanes();
            updateWIPCounters();
        });

        // Drag and Drop functionality
        function initializeDragAndDrop() {
            const cards = document.querySelectorAll('.card');
            const lanes = document.querySelectorAll('.lane');

            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            lanes.forEach(lane => {
                lane.addEventListener('dragover', handleDragOver);
                lane.addEventListener('drop', handleDrop);
                lane.addEventListener('dragenter', handleDragEnter);
                lane.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.id);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const cardId = e.dataTransfer.getData('text/plain');
            const card = document.querySelector(`[data-id="${cardId}"]`);
            const targetLane = e.currentTarget;
            const targetStatus = targetLane.dataset.status;

            if (card && targetLane.classList.contains('lane')) {
                // Update task status in data
                const task = tasks.find(t => t.id == cardId);
                if (task) {
                    task.status = targetStatus;
                }

                // Move card to new lane
                const laneContent = targetLane.querySelector('.lane-content');
                laneContent.appendChild(card);

                // Update card styling
                card.className = `card ${targetStatus}`;
                if (card.classList.contains('card-overdue')) {
                    card.classList.add('card-overdue');
                }

                // Update WIP counters
                updateWIPCounters();
            }

            e.currentTarget.classList.remove('drag-over');
        }

        // Filter functionality
        function initializeFilters() {
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    setActiveFilter(filter);
                    applyFilters();
                });
            });
        }

        function setActiveFilter(filter) {
            currentFilter = filter;
            filterButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
        }

        function applyFilters() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                let shouldShow = true;
                const task = tasks.find(t => t.id == card.dataset.id);

                if (currentFilter === 'overdue') {
                    shouldShow = isOverdue(task.due);
                } else if (currentFilter === 'week') {
                    shouldShow = isNextWeek(task.due);
                } else if (currentFilter === 'high') {
                    shouldShow = task.priority === 'high';
                }

                if (searchQuery) {
                    shouldShow = shouldShow && task.title.toLowerCase().includes(searchQuery.toLowerCase());
                }

                card.style.display = shouldShow ? 'block' : 'none';
            });
        }

        function isOverdue(dueDate) {
            return new Date(dueDate) < new Date();
        }

        function isNextWeek(dueDate) {
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const due = new Date(dueDate);
            return due >= today && due <= nextWeek;
        }

        // Search functionality
        function initializeSearch() {
            searchInput.addEventListener('input', function() {
                searchQuery = this.value;
                applyFilters();
            });
        }

        // Modal functionality
        function initializeModal() {
            addTaskBtn.addEventListener('click', () => {
                addTaskModal.classList.remove('hidden');
                addTaskModal.classList.add('flex');
            });

            closeModalBtn.addEventListener('click', closeModal);
            cancelAddBtn.addEventListener('click', closeModal);

            addTaskModal.addEventListener('click', (e) => {
                if (e.target === addTaskModal) {
                    closeModal();
                }
            });

            addSubtaskBtn.addEventListener('click', addSubtaskField);
            addTaskForm.addEventListener('submit', handleAddTask);
        }

        function closeModal() {
            addTaskModal.classList.add('hidden');
            addTaskModal.classList.remove('flex');
            addTaskForm.reset();
            resetSubtasks();
        }

        function addSubtaskField() {
            const subtaskDiv = document.createElement('div');
            subtaskDiv.className = 'flex gap-2 mb-2';
            subtaskDiv.innerHTML = `
                <input type="text" class="subtask-input flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Subtask description">
                <button type="button" class="remove-subtask px-3 py-2 text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            `;
            subtasksContainer.appendChild(subtaskDiv);

            subtaskDiv.querySelector('.remove-subtask').addEventListener('click', function() {
                subtaskDiv.remove();
            });
        }

        function resetSubtasks() {
            subtasksContainer.innerHTML = `
                <div class="flex gap-2 mb-2">
                    <input type="text" class="subtask-input flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Subtask description">
                    <button type="button" class="remove-subtask px-3 py-2 text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }

        function handleAddTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('task-title').value;
            const project = document.getElementById('task-project').value;
            const due = document.getElementById('task-due').value;
            const priority = document.getElementById('task-priority').value;
            
            const subtaskInputs = document.querySelectorAll('.subtask-input');
            const subtasks = Array.from(subtaskInputs)
                .map(input => ({ text: input.value, completed: false }))
                .filter(subtask => subtask.text.trim() !== '');

            const newTask = {
                id: Date.now(),
                title,
                project,
                due,
                priority,
                status: 'todo',
                subtasks
            };

            tasks.push(newTask);
            addTaskToDOM(newTask);
            updateWIPCounters();
            closeModal();
        }

        function addTaskToDOM(task) {
            const todoLane = document.querySelector('.lane.todo .lane-content');
            const taskElement = createTaskElement(task);
            todoLane.appendChild(taskElement);
        }

        function createTaskElement(task) {
            const card = document.createElement('div');
            card.className = `card ${task.status}`;
            card.draggable = true;
            card.dataset.id = task.id;
            card.dataset.due = task.due;
            card.dataset.priority = task.priority;

            if (isOverdue(task.due)) {
                card.classList.add('card-overdue');
            }

            const subtasksCompleted = task.subtasks.filter(s => s.completed).length;
            const subtasksTotal = task.subtasks.length;
            const progressPercent = subtasksTotal > 0 ? (subtasksCompleted / subtasksTotal) * 100 : 0;

            card.innerHTML = `
                <div class="p-3">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-800">${task.title}</h3>
                        <span class="priority-${task.priority}"><i class="fas fa-exclamation-circle"></i></span>
                    </div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="project-chip bg-blue-100 text-blue-800">${task.project}</span>
                        <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i>${formatDate(task.due)}</span>
                    </div>
                    <div class="mb-2">
                        <div class="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Subtasks (${subtasksCompleted}/${subtasksTotal})</span>
                            <span>${Math.round(progressPercent)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${task.status}" style="width: ${progressPercent}%"></div>
                        </div>
                    </div>
                </div>
            `;

            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);

            return card;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const diffTime = date - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) {
                return 'Overdue';
            } else if (diffDays === 0) {
                return 'Today';
            } else if (diffDays === 1) {
                return 'Tomorrow';
            } else if (diffDays <= 7) {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            } else {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
        }

        // Mobile lane functionality
        function initializeMobileLanes() {
            const laneToggles = document.querySelectorAll('.lane-toggle');
            laneToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const lane = this.closest('.lane');
                    lane.classList.toggle('collapsed');
                    
                    const icon = this.querySelector('i');
                    if (lane.classList.contains('collapsed')) {
                        icon.className = 'fas fa-chevron-right';
                    } else {
                        icon.className = 'fas fa-chevron-down';
                    }
                });
            });
        }

        // WIP counter updates
        function updateWIPCounters() {
            const lanes = document.querySelectorAll('.lane');
            lanes.forEach(lane => {
                const status = lane.dataset.status;
                const cardCount = lane.querySelectorAll('.card').length;
                const counter = lane.querySelector('.wip-counter');
                if (counter) {
                    counter.textContent = cardCount;
                }
            });
        }

        // Add card buttons functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('add-card-btn')) {
                addTaskBtn.click();
            }
        });
    </script>
</body>
</html>